<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jan Shikayat - Viksit Bharat Portal</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
   
    <!-- Firebase SDKs -->
    <script type="module">
        // Import necessary Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, Timestamp, setLogLevel, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
       
        // --- Firebase Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "YOUR_API_KEY", authDomain: "YOUR_AUTH_DOMAIN", projectId: "YOUR_PROJECT_ID" };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        setLogLevel('Debug'); // Enable Firestore logging

        // --- Firebase Authentication ---
        // We'll set up the auth listener after the DOM is loaded
        // to ensure elements are available.
       
        // Make db and key functions available globally in the script
        window.db = db;
        window.auth = auth; // Make auth globally available
        window.appId = appId; // Make appId globally available
       
        // RENAMED to 'complaints'
        window.complaintCollection = collection(db, 'artifacts', appId, 'public', 'data', 'complaints');
       
        window.fb = {
            addDoc,
            getDocs,
            query,
            where,
            Timestamp,
            doc, // ADDED for deletion
            deleteDoc // ADDED for deletion
        };

        // *** FIX: Attach auth functions to window.fb so they are globally accessible ***
        window.fb.onAuthStateChanged = onAuthStateChanged;
        window.fb.signInWithCustomToken = signInWithCustomToken;
        window.fb.signInAnonymously = signInAnonymously;


    </script>
   
    <!-- Custom Configuration for Indian Tricolor -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'saffron': '#FF9933',
                        'india-green': '#13880B',
                        'chakra-blue': '#000080',
                    }
                }
            }
        }
    </script>
   
    <!-- Inter Font and Custom Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
       
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Tailwind 'gray-50' */
        }
       
        /* Tricolor header bar */
        .tricolor-bar {
            display: flex;
            height: 4px; /* Thicker bar for visibility */
        }
        .tricolor-bar > div {
            flex: 1;
        }

        /* Style for the active navigation link */
        .nav-link.active-link {
            background-color: #FF9933; /* saffron */
        }

        /* Spinner for loading states */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #FF9933; /* saffron */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Tricolor Bar -->
    <div class="tricolor-bar">
        <div class="bg-saffron"></div>
        <div class="bg-white"></div>
        <div class="bg-india-green"></div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <!-- Government of India Logo -->
                <div class="flex items-center">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Emblem_of_India.svg/1200px-Emblem_of_India.svg.png"
                         alt="Government of India Emblem"
                         class="h-12 w-12 sm:h-16 sm:w-16 mr-3"
                         onerror="this.src='https://placehold.co/60x60?text=Logo'; this.onerror=null;">
                    <div>
                        <div class="text-lg sm:text-xl font-bold text-chakra-blue">Jan Shikayat</div>
                        <div class="text-sm text-gray-600">Government of India</div>
                    </div>
                </div>
               
                <!-- Viksit Bharat Logo -->
                <div class="mt-3 sm:mt-0 flex items-center space-x-3">
                    <img src="https://viksitbharat.mygov.in/assets/images/logo.svg"
                         alt="Viksit Bharat Logo"
                         class="h-12"
                         onerror="this.src='https://placehold.co/120x60?text=Viksit+Bharat'; this.onerror=null;">
                    <img src="https://amritmahotsav.nic.in/images/logo.png"
                         alt="Azadi Ka Amrit Mahotsav Logo"
                         class="h-12"
                         onerror="this.src='https://placehold.co/120x60?text=Logo+2'; this.onerror=null;">
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Bar -->
    <nav class="bg-chakra-blue">
        <div class="container mx-auto px-4">
            <div id="nav-links" class="flex flex-col sm:flex-row justify-center sm:justify-start items-center">
                <!-- Set "Home" as active by default -->
                <a href="javascript:void(0)" data-page="home" data-scroll="top" class="nav-link text-white font-medium py-3 px-4 hover:bg-chakra-blue/80 w-full sm:w-auto text-center sm:text-left active-link">Home</a>
                <a href="javascript:void(0)" data-page="about" data-scroll="top" class="nav-link text-white font-medium py-3 px-4 hover:bg-chakra-blue/80 w-full sm:w-auto text-center sm:text-left">About</a>
                <!-- RENAMED -->
                <a href="javascript:void(0)" data-page="lodge" data-scroll="top" class="nav-link text-white font-medium py-3 px-4 hover:bg-saffron/90 w-full sm:w-auto text-center sm:text-left">File Complaint</a>
                <!-- RENAMED -->
                <a href="javascript:void(0)" data-page="status" data-scroll="top" class="nav-link text-white font-medium py-3 px-4 hover:bg-chakra-blue/80 w-full sm:w-auto text-center sm:text-left">Check Status</a>
                <a href="javascript:void(0)" data-page="contact" data-scroll="top" class="nav-link text-white font-medium py-3 px-4 hover:bg-chakra-blue/80 w-full sm:w-auto text-center sm:text-left">Contact Us</a>
                <!-- NEW: Admin View Link -->
                <a href="javascript:void(0)" data-page="admin" data-scroll="top" class="nav-link text-white font-medium py-3 px-4 hover:bg-red-600/80 w-full sm:w-auto text-center sm:text-left ml-auto">Admin View</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
       
        <!-- PAGE 1: HOME (Grievance Portal) -->
        <div id="page-home" class="page-section">
            <!-- Viksit Bharat Welcome Section -->
            <div class="bg-white rounded-lg shadow-xl overflow-hidden mb-8 border border-gray-200">
                <div class="md:flex">
                    <!-- PM Modi's Photo - UPDATED SRC -->
                    <div class="md:w-1/3">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRbgpDjkj0tlllY2wcVTwdKIU9dIqwov-frHA&s"
                             alt="Prime Minister Narendra Modi"
                             class="w-full h-full object-cover"
                             onerror="this.src='https://placehold.co/400x450?text=Photo'; this.onerror=null;">
                    </div>
                    <!-- Welcome Text -->
                    <div class="p-6 md:p-8 md:w-2/3">
                        <h1 class="text-xl font-bold text-saffron uppercase tracking-wide">A Viksit Bharat Initiative</h1>
                        <h2 class="text-3xl sm:text-4xl font-bold text-chakra-blue mt-2">Participate in Nation Building</h2>
                        <p class="mt-4 text-gray-700 leading-relaxed">
                            This portal is your direct link to contribute to our nation's progress. By voicing your concerns and providing valuable feedback on public services, you play a crucial role in building a 'Viksit Bharat' (Developed India).
                        </p>
                        <p class="mt-3 text-gray-700 leading-relaxed">
                            We are committed to transparency, accountability, and citizen-centric governance. Your complaint is not just a problem; it is an opportunity for us to improve and serve you better.
                        </p>
                        <!-- RENAMED -->
                        <a href="javascript:void(0)" data-page="lodge" data-scroll="top" class="nav-link-action inline-block text-white bg-saffron hover:bg-saffron/90 font-bold rounded-lg text-lg px-10 py-3 transition-all duration-300 shadow-lg mt-6">
                            File Your Complaint Now
                        </a>
                    </div>
                </div>
            </div>
        </div> <!-- End of page-home -->

        <!-- PAGE 2: FILE COMPLAINT (RENAMED) -->
        <div id="page-lodge" class="page-section hidden">
            <div class="max-w-3xl mx-auto">
                <div class="w-full bg-white p-6 sm:p-8 rounded-lg shadow-xl border border-gray-200">
                    <!-- RENAMED -->
                    <h2 class="text-2xl sm:text-3xl font-bold text-chakra-blue mb-6 border-b-2 border-saffron pb-3">Submit Your Complaint</h2>
                    <p class="text-gray-600 mb-6">Please provide the details of your complaint. All fields are mandatory.</p>
                   
                    <form id="complaintForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Name -->
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input type="text" id="name" name="name" required
                                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                                       placeholder="e.g., Ramesh Kumar">
                            </div>
                           
                            <!-- Phone Number -->
                            <div>
                                <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Mobile Number</label>
                                <input type="tel" id="phone" name="phone" required pattern="[6-9][0-9]{9}"
                                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                                       placeholder="10-digit mobile number">
                            </div>
                           
                            <!-- City -->
                            <div>
                                <label for="city" class="block text-sm font-medium text-gray-700 mb-1">City</label>
                                <input type="text" id="city" name="city" required
                                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                                       placeholder="e.g., New Delhi, Mumbai">
                            </div>

                            <!-- Area/Locality -->
                            <div>
                                <label for="area" class="block text-sm font-medium text-gray-700 mb-1">Area / Locality</label>
                                <input type="text" id="area" name="area" required
                                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                                       placeholder="e.g., Chandni Chowk, Sector 15">
                            </div>
                        </div>
                       
                        <!-- Complaint Details -->
                        <div class="mt-6">
                            <label for="complaint" class="block text-sm font-medium text-gray-700 mb-1">
                                Details of Complaint
                            </label>
                            <textarea id="complaint" name="complaint" rows="5" required
                                      class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                                      placeholder="Please describe your issue in detail..."></textarea>
                        </div>
                       
                        <!-- File Upload -->
                        <div class="mt-6">
                            <label for="attachment" class="block text-sm font-medium text-gray-700 mb-1">
                                Attach Supporting Document (Optional)
                            </label>
                            <input type="file" id="attachment" name="attachment"
                                   class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4
                                          file:rounded-md file:border-0 file:text-sm file:font-semibold
                                          file:bg-chakra-blue/10 file:text-chakra-blue hover:file:bg-chakra-blue/20">
                        </div>

                        <!-- Submit Button -->
                        <div class="mt-8 text-center">
                            <!-- RENAMED -->
                            <button type="submit"
                                    class="w-full sm:w-auto text-white bg-saffron hover:bg-saffron/90 focus:ring-4 focus:outline-none focus:ring-saffron/50
                                           font-bold rounded-lg text-lg px-12 py-3 transition-all duration-300 shadow-lg">
                                Submit Complaint
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div> <!-- End of page-lodge -->

        <!-- PAGE 3: CHECK STATUS (RENAMED) -->
        <div id="page-status" class="page-section hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Check Status Box -->
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl border border-gray-200">
                    <!-- RENAMED -->
                    <h2 class="text-2xl font-bold text-chakra-blue mb-6 border-b-2 border-india-green pb-3">Check Complaint Status</h2>
                    <form id="statusForm">
                        <!-- RENAMED -->
                        <label for="complaint_id" class="block text-sm font-medium text-gray-700 mb-1">Enter Your Complaint ID</label>
                        <input type="text" id="complaint_id" name="complaint_id" required
                               class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                               placeholder="e.g., C-1678886400000">
                        <button type="submit" id="checkStatusButton"
                                class="w-full text-white bg-india-green hover:bg-india-green/90 focus:ring-4 focus:outline-none focus:ring-india-green/50
                                       font-bold rounded-lg text-lg px-12 py-3 transition-all duration-300 shadow-lg mt-4">
                            Check Status
                        </button>
                    </form>
                </div>

                <!-- How It Works Box -->
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl border border-gray-200">
                    <h2 class="text-2xl font-bold text-chakra-blue mb-6 border-b-2 border-india-green pb-3">How It Works</h2>
                    <ol class="list-decimal list-inside space-y-3 text-gray-700">
                        <li class="flex items-center">
                            <span class="inline-block bg-chakra-blue text-white rounded-full w-6 h-6 text-sm font-bold text-center mr-3">1</span>
                            Submit your complaint with details.
                        </li>
                        <li class="flex items-center">
                            <span class="inline-block bg-chakra-blue text-white rounded-full w-6 h-6 text-sm font-bold text-center mr-3">2</span>
                            Receive a unique ID on this screen.
                        </li>
                        <li class="flex items-center">
                            <span class="inline-block bg-chakra-blue text-white rounded-full w-6 h-6 text-sm font-bold text-center mr-3">3</span>
                            Track your complaint status online.
                        </li>
                        <li class="flex items-center">
                            <span class="inline-block bg-chakra-blue text-white rounded-full w-6 h-6 text-sm font-bold text-center mr-3">4</span>
                            Receive a final resolution and report.
                        </li>
                    </ol>
                </div>
            </div>
        </div> <!-- End of page-status -->


        <!-- PAGE 4: ABOUT US -->
        <div id="page-about" class="page-section hidden">
            <div class="bg-white p-6 sm:p-10 rounded-lg shadow-xl border border-gray-200">
                <h1 class="text-3xl font-bold text-chakra-blue mb-6 border-b-2 border-saffron pb-3">About Us</h1>
                <div class="space-y-6 text-gray-700 leading-relaxed">
                    <p>Welcome to the Jan Shikayat Portal, a cornerstone of the 'Viksit Bharat' initiative. We are dedicated to providing a transparent, accessible, and efficient platform for every citizen to voice their concerns and seek resolution.</p>
                   
                    <h2 class="text-2xl font-semibold text-chakra-blue mt-4">Our Mission</h2>
                    <p>Our mission is to bridge the gap between citizens and governance by ensuring that every complaint is heard, acknowledged, and addressed in a timely and effective manner. We are committed to upholding the principles of accountability and citizen-centric service delivery.</p>

                    <h2 class="text-2xl font-semibold text-chakra-blue mt-4">Our Vision</h2>
                    <p>We envision a 'Viksit Bharat' where governance is participatory, transparent, and responsive. This portal is a significant step towards empowering citizens to become active partners in the nation's development by holding public services accountable and fostering a culture of continuous improvement.</p>
               
                    <h2 class="text-2xl font-semibold text-chakra-blue mt-4">What We Handle</h2>
                    <p>You can file any simple to complex complaint you want. Our primary focus includes:</p>
                    <ul class="list-disc list-inside ml-4 space-y-2">
                        <li>Complaints related to public infrastructure (roads, water, electricity).</li>
                        <li>Issues with municipal services (sanitation, waste management).</li>
                        <li>Delays or inefficiencies in government services.</li>
                        <li>Suggestions for improvements in public policy and service delivery.</li>
                    </ul>
                </div>
            </div>
        </div> <!-- End of page-about -->

        <!-- PAGE 5: CONTACT US -->
        <div id="page-contact" class="page-section hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Contact Form -->
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl border border-gray-200">
                    <h1 class="text-3xl font-bold text-chakra-blue mb-6 border-b-2 border-saffron pb-3">Contact Us</h1>
                    <p class="text-gray-600 mb-6">Have a question or need technical support? Fill out the form below and our team will get back to you.</p>
                   
                    <form id="contactForm">
                        <div class="space-y-6">
                            <!-- Name -->
                            <div>
                                <label for="contact-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input type="text" id="contact-name" name="contact-name" required
                                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                                       placeholder="e.g., Ramesh Kumar">
                            </div>
                            <!-- Email -->
                            <div>
                                <label for="contact-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                <input type="email" id="contact-email" name="contact-email" required
                                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                                       placeholder="e.g., ramesh@example.com">
                            </div>
                            <!-- Message -->
                            <div>
                                <label for="contact-message" class="block text-sm font-medium text-gray-700 mb-1">Your Message</label>
                                <textarea id="contact-message" name="contact-message" rows="5" required
                                          class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-chakra-blue focus:border-chakra-blue"
                                          placeholder="Your question or message..."></textarea>
                            </div>
                        </div>
                        <!-- Submit Button -->
                        <div class="mt-8">
                            <button type="submit"
                                    class="w-full text-white bg-saffron hover:bg-saffron/90 focus:ring-4 focus:outline-none focus:ring-saffron/50
                                           font-bold rounded-lg text-lg px-12 py-3 transition-all duration-300 shadow-lg">
                                Send Message
                            </button>
                        </div>
                    </form>
                </div>
               
                <!-- Contact Details -->
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl border border-gray-200">
                    <h2 class="text-2xl font-bold text-chakra-blue mb-6 border-b-2 border-india-green pb-3">Get in Touch</h2>
                    <div class="space-y-4 text-gray-700">
                        <p class="flex items-start">
                            <span class="mt-1 mr-3 text-chakra-blue">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.518.76a11.034 11.034 0 006.364 6.364l.76-1.518a1 1 0 011.06-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2.153a1 1 0 01-.986-.836l-.74-4.435a1 1 0 01.54-1.06l1.518-.76a11.034 11.034 0 00-6.364-6.364l-.76 1.518a1 1 0 01-1.06.54l-4.435-.74A1 1 0 012 3z" /></svg>
                            </span>
                            <strong>Toll-Free Helpline:</strong><br>
                            <span class="ml-4">9651183472</span>
                        </p>
                        <p class="flex items-start">
                            <span class="mt-1 mr-3 text-chakra-blue">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" /><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" /></svg>
                            </span>
                            <strong>Email Support:</strong><br>
                            <span class="ml-4">12086@jaipuria.com</span>
                        </p>
                        <p class="flex items-start">
                            <span class="mt-1 mr-3 text-chakra-blue">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>
                            </span>
                            <strong>Address:</strong><br>
                            <span class="ml-4">Lucknow Nagar Nigam, Triloknath Road, Lalbagh, Lucknow, Uttar Pradesh - 226001</span>
                        </p>
                    </div>
                </div>
            </div>
        </div> <!-- End of page-contact -->
       
        <!-- NEW: PAGE 6: ADMIN VIEW -->
        <div id="page-admin" class="page-section hidden">
            <div class="bg-white p-6 sm:p-10 rounded-lg shadow-xl border border-gray-200">
                <h1 class="text-3xl font-bold text-chakra-blue mb-6 border-b-2 border-saffron pb-3">Admin View - All Complaints</h1>
                <p class="text-gray-600 mb-6">All submitted complaints are listed below. This view is for administrative purposes only.</p>
               
                <!-- Complaints Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Complaint ID</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">City / Area</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Complaint</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                            </tr>
                        </thead>
                        <tbody id="admin-complaint-list" class="bg-white divide-y divide-gray-200">
                            <!-- Rows will be injected here by JavaScript -->
                            <!-- Example of a row: -->
                            <!--
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">C-123456</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12/05/2025</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Ramesh Kumar</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">9876543210</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Lucknow / Lalbagh</td>
                                <td class="px-6 py-4 text-sm text-gray-500 min-w-[200px]"><div class="truncate w-48">Broken streetlight...</div></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Submitted</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button class="text-red-600 hover:text-red-900 delete-btn" data-id="DOC_ID_HERE">Delete</button>
                                </td>
                            </tr>
                            -->
                            <tr>
                                <td colspan="8" class="px-6 py-10 text-center text-gray-500">
                                    <div class="flex justify-center items-center space-x-2">
                                        <div class="spinner"></div>
                                        <span>Loading complaints...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div> <!-- End of page-admin -->

    </main>

    <!-- Footer -->
    <footer class="bg-chakra-blue text-white mt-12 py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm">
                This website is designed, developed, and maintained by the National Informatics Centre (NIC),
                <br>Ministry of Electronics & Information Technology, Government of India.
            </p>
            <p class="text-sm mt-2">&copy; <span id="currentYear">2025</span> Jan Shikayat Portal. All rights reserved.</p>
            <p class="text-xs mt-2 text-gray-300">Last Updated: <span id="lastUpdated">01 January 2025</span></p>
        </div>
    </footer>

    <!-- Message Box -->
    <div id="messageBox"
          class="hidden fixed top-20 right-5 z-50 p-4 rounded-md shadow-lg text-white max-w-sm transition-all duration-300">
         <p id="messageText"></p>
    </div>

    <!-- UPDATED: Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen p-4 text-center">
            <!-- Modal Overlay -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
           
            <!-- Modal Content -->
            <div class="inline-block bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:max-w-lg sm:w-full border-t-4 border-india-green">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <!-- Icon -->
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                            <svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        <!-- Text -->
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <!-- RENAMED -->
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Complaint Submitted Successfully</h3>
                            <div class="mt-2">
                                <!-- UPDATED TEXT -->
                                <p class="text-sm text-gray-500">Your complaint has been registered. A professional will look into it in 1-2 days.</p>
                                <!-- RENAMED -->
                                <p class="mt-3 text-lg font-bold text-chakra-blue">Your Complaint ID:</p>
                                <p id="modalComplaintId" class="text-xl font-bold text-gray-800 bg-gray-100 p-2 rounded text-center"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button id="closeModalButton" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-chakra-blue text-base font-medium text-white hover:bg-chakra-blue/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-chakra-blue sm:ml-3 sm:w-auto sm:text-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- JavaScript Logic -->
    <script>
        // Use a function to ensure auth is handled after DOM content is loaded
        async function initializeApp() {
            try {
                if (typeof window.auth === 'undefined' || typeof window.fb.onAuthStateChanged === 'undefined') { // MODIFIED: Check for the function on window.fb
                    console.error("Firebase Auth is not initialized correctly.");
                    return; // Exit if auth is not ready
                }
               
                // Wait for auth state to be confirmed
                await new Promise((resolve, reject) => {
                    // *** FIX: Call the function from the window.fb object ***
                    const unsubscribe = window.fb.onAuthStateChanged(window.auth, async (user) => {
                        unsubscribe(); // Stop listening after first check
                        if (user) {
                            console.log("User is signed in:", user.uid);
                            resolve(user);
                        } else if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            try {
                                // *** FIX: Call the function from the window.fb object ***
                                const userCredential = await window.fb.signInWithCustomToken(window.auth, __initial_auth_token);
                                console.log("Signed in with custom token.");
                                resolve(userCredential.user);
                            } catch (tokenError) {
                                console.error("Custom token sign-in error:", tokenError);
                                reject(tokenError);
                            }
                        } else {
                            try {
                                // *** FIX: Call the function from the window.fb object ***
                                const userCredential = await window.fb.signInAnonymously(window.auth);
                                console.log("Signed in anonymously.");
                                resolve(userCredential.user);
                            } catch (anonError) {
                                console.error("Anonymous sign-in error:", anonError);
                                reject(anonError);
                            }
                        }
                    }, (error) => {
                        console.error("Auth state change error:", error);
                        reject(error);
                    });
                });

                console.log("Firebase Auth is ready.");
               
            } catch (error) {
                console.error("Firebase Auth Error:", error);
                const messageBox = document.getElementById('messageBox');
                if (messageBox) {
                    messageBox.textContent = 'Error: Could not connect to authentication service.';
                    messageBox.classList.remove('hidden', 'bg-green-600', 'bg-blue-600');
                    messageBox.classList.add('bg-red-500');
                }
            }
        }


        document.addEventListener('DOMContentLoaded', async function() {
           
            // Initialize Firebase Auth first
            await initializeApp();

            // --- Page Switching Logic ---
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page-section');
            const navContainer = document.getElementById('nav-links');
            const actionLinks = document.querySelectorAll('.nav-link-action'); // Links like "Lodge Your Grievance Now" button

            // Function to handle page switching
            async function switchPage(pageId, scrollTarget) {
                // 1. Handle Active Link in Nav
                navLinks.forEach(link => {
                    link.classList.remove('active-link');
                    // Check if this link's data-page matches the new pageId
                    if (link.dataset.page === pageId) {
                        link.classList.add('active-link');
                    }
                });

                // 2. Handle Page Visibility
                pages.forEach(page => {
                    if (page.id === 'page-' + pageId) {
                        page.classList.remove('hidden');
                    } else {
                        page.classList.add('hidden');
                    }
                });

                // 3. Handle Scrolling
                if (scrollTarget) {
                    if (scrollTarget === 'top') {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    } else {
                        const targetElement = document.querySelector(scrollTarget);
                        if (targetElement) {
                            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }
                }
               
                // 4. NEW: Load data if Admin View is opened
                if (pageId === 'admin') {
                    await loadAdminComplaints();
                }
            }

            // Listen for clicks on the main navigation
            navContainer.addEventListener('click', function(e) {
                const clickedLink = e.target.closest('.nav-link');
                if (!clickedLink) return;

                e.preventDefault();
                const pageId = clickedLink.dataset.page;
                const scrollTarget = clickedLink.dataset.scroll;
                switchPage(pageId, scrollTarget);
            });

            // Listen for clicks on other action links (e.g., button on home page)
            actionLinks.forEach(actionLink => {
                actionLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = actionLink.dataset.page;
                    const scrollTarget = actionLink.dataset.scroll;
                    switchPage(pageId, scrollTarget);
                });
            });


            // --- Existing Logic ---

            // Set dynamic dates in footer
            const today = new Date();
            const currentYearEl = document.getElementById('currentYear');
            const lastUpdatedEl = document.getElementById('lastUpdated');
           
            if (currentYearEl) {
                currentYearEl.textContent = today.getFullYear();
            }
            if (lastUpdatedEl) {
                lastUpdatedEl.textContent = today.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric'
                });
            }


            const complaintForm = document.getElementById('complaintForm');
            const statusForm = document.getElementById('statusForm');
            const contactForm = document.getElementById('contactForm');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
           
            // --- Modal Elements ---
            const successModal = document.getElementById('successModal');
            const closeModalButton = document.getElementById('closeModalButton');
            const modalComplaintId = document.getElementById('modalComplaintId'); // RENAMED

            // --- Modal Close Logic ---
            if (closeModalButton) {
                closeModalButton.addEventListener('click', () => {
                    successModal.classList.add('hidden');
                });
            }

            // Handle complaint form submission (RENAMED)
            if (complaintForm) {
                complaintForm.addEventListener('submit', async function(e) { // Made async
                    e.preventDefault();
                   
                    // Get form values
                    const name = document.getElementById('name').value;
                    const phone = document.getElementById('phone').value;
                    const city = document.getElementById('city').value;
                    const area = document.getElementById('area').value;
                    const complaint = document.getElementById('complaint').value;

                    // Simple validation
                    if (!name || !phone || !city || !area || !complaint) {
                        showMessage('Please fill in all mandatory fields.', 'error');
                        return;
                    }
                   
                    if (!/^[6-9]\d{9}$/.test(phone)) {
                        showMessage('Please enter a valid 10-digit mobile number.', 'error');
                        return;
                    }

                    if (typeof window.db === 'undefined' || typeof window.complaintCollection === 'undefined') {
                        showMessage('Error: Database connection not established. Please refresh.', 'error');
                        return;
                    }

                    // Generate a unique Complaint ID (RENAMED)
                    const complaintId = `C-${Date.now()}`;

                    try {
                        // Create a complaint object (RENAMED)
                        const complaintData = {
                            complaintId: complaintId,
                            name: name,
                            phone: phone,
                            city: city,
                            area: area,
                            complaint: complaint,
                            submittedAt: window.fb.Timestamp.now(),
                            status: "Submitted" // Initial status
                        };

                        // Add the document to Firestore
                        const docRef = await window.fb.addDoc(window.complaintCollection, complaintData);
                       
                        console.log("Document written with ID: ", docRef.id);

                        // Show success MODAL (RENAMED)
                        modalComplaintId.textContent = complaintId;
                        successModal.classList.remove('hidden');
                       
                        // Reset the form
                        complaintForm.reset();

                    } catch (error) {
                        console.error("Error adding document: ", error);
                        showMessage('Error submitting complaint. Please try again.', 'error');
                    }
                });
            }

            // Handle status check submission (RENAMED)
            if (statusForm) {
                statusForm.addEventListener('submit', async function(e) { // Made async
                    e.preventDefault();
                    const complaintId = document.getElementById('complaint_id').value; // RENAMED
                   
                    if (!complaintId) {
                        showMessage('Please enter your Complaint ID.', 'error');
                        return;
                    }

                    if (typeof window.db === 'undefined' || typeof window.complaintCollection === 'undefined') {
                        showMessage('Error: Database connection not established. Please refresh.', 'error');
                        return;
                    }

                    try {
                        // Create a query (RENAMED)
                        const q = window.fb.query(window.complaintCollection, window.fb.where("complaintId", "==", complaintId));
                       
                        const querySnapshot = await window.fb.getDocs(q);
                       
                        if (querySnapshot.empty) {
                            showMessage(`Complaint ID "${complaintId}" not found. Please check the ID and try again.`, 'error');
                        } else {
                            querySnapshot.forEach((doc) => {
                                const data = doc.data();
                                const status = data.status || "Unknown";
                                showMessage(`Status for ${complaintId}: ${status}`, 'info');
                            });
                        }

                    } catch (error) {
                        console.error("Error fetching status: ", error);
                        showMessage('Error checking status. Please try again.', 'error');
                    }
                });
            }

            // Handle contact form submission
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const name = document.getElementById('contact-name').value;
                    const email = document.getElementById('contact-email').value;
                    const message = document.getElementById('contact-message').value;

                    if (!name || !email || !message) {
                        showMessage('Please fill in all fields.', 'error');
                        return;
                    }
                   
                    showMessage('Message sent! We will get back to you soon.', 'success');
                    contactForm.reset();
                });
            }

            // --- NEW: Admin View Logic ---
            const adminComplaintList = document.getElementById('admin-complaint-list');
           
            // Function to load all complaints into the admin table
            async function loadAdminComplaints() {
                if (!adminComplaintList) return;
               
                adminComplaintList.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-10 text-center text-gray-500">
                            <div class="flex justify-center items-center space-x-2">
                                <div class="spinner"></div>
                                <span>Loading complaints...</span>
                            </div>
                        </td>
                    </tr>`;
               
                if (typeof window.db === 'undefined' || typeof window.complaintCollection === 'undefined') {
                    adminComplaintList.innerHTML = `<tr><td colspan="8" class="px-6 py-10 text-center text-red-500">Error: Database connection not established.</td></tr>`;
                    return;
                }

                try {
                    const querySnapshot = await window.fb.getDocs(window.complaintCollection);
                   
                    if (querySnapshot.empty) {
                        adminComplaintList.innerHTML = `<tr><td colspan="8" class="px-6 py-10 text-center text-gray-500">No complaints found.</td></tr>`;
                        return;
                    }

                    adminComplaintList.innerHTML = ''; // Clear loading spinner
                   
                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const docId = doc.id; // This is the Firestore Document ID, needed for deletion
                       
                        const date = data.submittedAt ? data.submittedAt.toDate().toLocaleDateString('en-IN') : 'N/A';
                       
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${data.complaintId || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.phone}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.city} / ${data.area}</td>
                            <td class="px-6 py-4 text-sm text-gray-500">
                                <div class="w-48 overflow-hidden overflow-ellipsis whitespace-nowrap" title="${data.complaint}">${data.complaint}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                    ${data.status}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <button class="text-red-600 hover:text-red-900 delete-btn" data-id="${docId}">Delete</button>
                            </td>
                        `;
                        adminComplaintList.appendChild(row);
                    });

                } catch (error) {
                    console.error("Error loading complaints: ", error);
                    adminComplaintList.innerHTML = `<tr><td colspan="8" class="px-6 py-10 text-center text-red-500">Error loading complaints. Please try again.</td></tr>`;
                }
            }

            // NEW: Event listener for delete buttons
            if (adminComplaintList) {
                adminComplaintList.addEventListener('click', async (e) => {
                    if (e.target.classList.contains('delete-btn')) {
                        const docId = e.target.dataset.id;
                        if (!docId) return;

                        // Optional: Add a confirmation dialog
                        // if (!confirm('Are you sure you want to delete this complaint?')) {
                        //     return;
                        // }

                        try {
                            // Get a reference to the specific document
                            const docRef = window.fb.doc(window.db, 'artifacts', window.appId, 'public', 'data', 'complaints', docId);
                           
                            // Delete the document
                            await window.fb.deleteDoc(docRef);
                           
                            showMessage('Complaint deleted successfully.', 'success');
                           
                            // Refresh the admin view
                            await loadAdminComplaints();
                           
                        } catch (error) {
                            console.error("Error deleting document: ", error);
                            showMessage('Error deleting complaint.', 'error');
                        }
                    }
                });
            }


            // Function to show the custom message box
            function showMessage(message, type) {
                if (!messageBox || !messageText) return;

                messageText.textContent = message;
               
                // Reset colors
                messageBox.classList.remove('bg-green-600', 'bg-red-500', 'bg-blue-600');

                // Set color
                if (type === 'success') {
                    messageBox.classList.add('bg-green-600');
                } else if (type === 'error') {
                    messageBox.classList.add('bg-red-500');
                } else {
                    // 'info' or other types
                    messageBox.classList.add('bg-blue-600');
                }
               
                // Show message
                messageBox.classList.remove('hidden');
               
                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 5000);
            }
        });
    </script>

</body>
</html>
