<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gifté+ — AI Mode</title>
  <style>
    :root{
      --bg: linear-gradient(135deg,#fff0f8 0%,#ffe6f2 30%,#fff0ff 60%,#f0f5ff 100%);
      --accent-1: #ff6fa3;
      --accent-2: #8b5cf6;
      --muted: #6b7280;
      --card: #ffffff;
      --radius:16px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:#0f172a;-webkit-font-smoothing:antialiased}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:white;box-shadow:0 14px 40px rgba(139,92,246,0.12)}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:20px}
    @media(max-width:980px){ .grid{grid-template-columns:1fr;} .rightColumn{order:2} }
    .panel{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 10px 30px rgba(15,23,42,0.06)}
    label{display:block;margin-top:12px;color:var(--muted);font-size:13px}
    input,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #eef2ff;margin-top:8px;font-size:14px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{padding:8px 10px;border-radius:999px;background:linear-gradient(90deg,rgba(139,92,246,0.08),rgba(255,111,163,0.06));border:1px solid rgba(139,92,246,0.06);cursor:pointer;font-size:13px}
    .chip.active{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:white;border:0;box-shadow:0 8px 30px rgba(139,92,246,0.12)}
    .btn{display:inline-block;padding:12px 16px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:white;font-weight:700;cursor:pointer;margin-top:14px;font-size:14px}
    .btn.secondary{background:transparent;border:1px solid rgba(15,23,42,0.06);color:var(--muted);font-weight:600}
    .hint{font-size:13px;color:var(--muted);margin-top:8px}
    .links{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap}
    .linkBtn{display:inline-block;padding:6px 8px;border-radius:6px;background:linear-gradient(90deg,#3b82f6,#06b6d4);color:white;text-decoration:none;font-size:12px;font-weight:600}
    .linkBtn:hover{filter:brightness(1.05)}
    .linkBtn.amazon{background:linear-gradient(90deg,#ff9900,#ff6600)}

    .resultHeader{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .resultGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:14px;margin-top:12px}
    @media(max-width:820px){ .resultGrid{grid-template-columns:1fr} }
    .giftCard{background:linear-gradient(180deg,rgba(255,255,255,0.95),#fff);border-radius:14px;padding:14px;box-shadow:0 12px 30px rgba(15,23,42,0.06);overflow:hidden;transform:translateY(6px);opacity:0;transition:transform .35s ease,opacity .35s ease;max-width:300px}
    .giftCard.show{transform:translateY(0);opacity:1}
    .giftTop{display:flex;gap:12px;align-items:center}
    .giftThumb{width:60px;height:60px;border-radius:10px;flex-shrink:0;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:800;overflow:hidden}
    .giftThumb img{width:100%;height:100%;object-fit:cover;display:block}
    .giftTitle{font-size:14px;margin:0;font-weight:600}
    .giftMeta{font-size:12px;color:var(--muted);margin-top:4px;line-height:1.3}
    .smallBadge{display:inline-block;padding:4px 6px;border-radius:6px;background:rgba(15,23,42,0.04);font-size:11px;color:var(--muted);margin-top:6px}
    .happy{margin-top:16px;padding:14px;border-radius:12px;background:linear-gradient(90deg,#fff7fb,#fffefc);text-align:center;box-shadow:0 10px 30px rgba(255,111,163,0.06)}
    .controls{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .clearBtn{background:transparent;border:1px dashed rgba(15,23,42,0.06);padding:8px 10px;border-radius:8px;cursor:pointer;color:var(--muted);font-size:13px}
    footer{margin-top:26px;text-align:center;color:var(--muted);font-size:13px}

    /* LOADER */
    #loader{
      grid-column:1/-1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:40px 0;
      color:var(--muted);
    }
    .spinner{
      width:32px;height:32px;
      border:4px solid #f3f3f3;
      border-top:4px solid var(--accent-2);
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin-bottom:12px;
    }
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

    /* PULSE */
    @keyframes pulse {0%,100%{opacity:1}50%{opacity:0.5}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">G+</div>
        <div>
          <h1>Gifté+ — AI Mode</h1>
          <div class="subtitle">16 real gift ideas with photos — Gemini + Unsplash</div>
        </div>
      </div>
      <div class="subtitle">Signed-in: <strong id="signedEmail">(local)</strong></div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div>
        <div class="panel" id="formPanel">
          <h2 id="formTitle" style="margin:0">Tell us about the recipient</h2>
          <p class="hint">Fill the required fields. Interests are optional.</p>

          <label>Budget (INR) — required</label>
          <input id="budget" type="number" min="0" placeholder="e.g. 2500" required>

          <label>Occasion — required</label>
          <select id="occasion" required>
            <option value="">Choose occasion</option>
            <option>Birthday</option><option>Anniversary</option><option>Graduation</option>
            <option>Farewell</option><option>Wedding</option><option>Baby Shower</option>
            <option>Festival</option><option>Just Because</option><option>Valentine's</option>
          </select>

          <label>Relationship — required</label>
          <select id="relationship" required>
            <option value="">Choose relationship</option>
            <option>Partner</option><option>Daughter</option><option>Son</option>
            <option>Friend</option><option>Parent</option><option>Sibling</option>
            <option>Colleague</option><option>Teacher</option><option>Child</option>
          </select>

          <label>Interests — choose any (click chips)</label>
          <div class="chips" id="interests"></div>

          <label>Additional notes (optional)</label>
          <textarea id="notes" rows="3" placeholder="Favourite colour, allergy, etc."></textarea>

          <div class="controls">
            <button id="findBtn" class="btn">Find My Gift (AI)</button>
            <button id="saveBtn" class="btn secondary">Save Session</button>
            <button id="clearBtn" class="clearBtn">Clear</button>
          </div>

          <div class="hint" id="formError" style="display:none;color:#c92a2a"></div>
        </div>

        <div class="panel" id="resultsPanel" style="margin-top:16px">
          <div class="resultHeader">
            <div>
              <div style="font-weight:700">AI Recommendations</div>
              <div class="smallBadge" id="matchSummary">No results yet</div>
            </div>
            <div class="hint">16 real gifts with photos.</div>
          </div>

          <div class="resultGrid" id="resultGrid" style="margin-top:10px"></div>

          <div id="fallback" style="display:none;margin-top:12px;color:var(--muted)">No suggestions – try changing the inputs.</div>
          <div class="happy" id="happyMsg" style="display:none">We’re happy you found your gift with Gifté+ AI!</div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="rightColumn">
        <div class="panel">
          <h3 style="margin:0">Quick Filters & Popular Interests</h3>
          <div class="hint">Tap chips to toggle interests quickly.</div>
          <div style="margin-top:12px" id="quickChips"></div>

          <h4 style="margin-top:18px">Saved Sessions</h4>
          <div id="savedList" style="margin-top:8px;font-size:14px;color:var(--muted)">(none yet)</div>
        </div>
      </div>
    </div>

    <footer>© 2025 Gifté+. Designed by Delta-1 & Commander.</footer>
  </div>

  <script>
    // ==============================
    // 1. CONFIG
    // ==============================
    const GEMINI_API_KEY = "AIzaSyA9XdnhSEMWshJaSKreGN6lheFJ9DYk5UI";   // ← YOUR GEMINI KEY
    const UNSPLASH_ACCESS_KEY = ""; // ← Optional: https://unsplash.com/developers
    const AMAZON_AFFILIATE_TAG = ""; // ← Optional: Your Amazon tag (e.g. 'yourid-21')

    // ==============================
    // 2. UI refs
    // ==============================
    const interestsDiv   = document.getElementById('interests');
    const quickChips     = document.getElementById('quickChips');
    const resultGrid     = document.getElementById('resultGrid');
    const matchSummary   = document.getElementById('matchSummary');
    const findBtn        = document.getElementById('findBtn');
    const saveBtn        = document.getElementById('saveBtn');
    const clearBtn       = document.getElementById('clearBtn');
    const budgetEl       = document.getElementById('budget');
    const occasionEl     = document.getElementById('occasion');
    const relationshipEl = document.getElementById('relationship');
    const notesEl        = document.getElementById('notes');
    const formError      = document.getElementById('formError');
    const savedList      = document.getElementById('savedList');
    const happyMsg       = document.getElementById('happyMsg');
    const signedEmail    = document.getElementById('signedEmail');

    signedEmail.innerText = localStorage.getItem('aditya_signed_email') || '(local)';

    // ==============================
    // 3. Interests chips
    // ==============================
    const allInterests = [
      'Tech','Music','Books','Fashion','Home & Kitchen','Food & Drink','Travel','Fitness','Photography','Art',
      'Gaming','Beauty','Gardening','Parenting','Kids','Sports','DIY','Hobby','Stationery','Pet Owner'
    ];
    function createChip(name, parent, initial=false){
      const el = document.createElement('div');
      el.className = 'chip';
      el.innerText = name;
      el.dataset.tag = name;
      if(initial) el.classList.add('active');
      el.addEventListener('click', ()=> el.classList.toggle('active'));
      parent.appendChild(el);
    }
    allInterests.forEach(i => createChip(i, interestsDiv));
    allInterests.slice(0,8).forEach(i => createChip(i, quickChips));

    function getSelectedInterests(){
      return Array.from(interestsDiv.querySelectorAll('.chip.active')).map(c=>c.dataset.tag);
    }

    // ==============================
    // 4. Get REAL image from Unsplash
    // ==============================
    async function getRealGiftImage(title) {
      const query = encodeURIComponent(title);
      let url = `https://source.unsplash.com/featured/300x300/?${query}`;

      if (UNSPLASH_ACCESS_KEY) {
        try {
          const res = await fetch(`https://api.unsplash.com/search/photos?query=${query}&per_page=1&client_id=${UNSPLASH_ACCESS_KEY}`);
          const data = await res.json();
          if (data.results?.[0]?.urls?.small) {
            return data.results[0].urls.small;
          }
        } catch (e) { /* fall back */ }
      }
      return url;
    }

    // ==============================
    // 5. Build Amazon link
    // ==============================
    function getAmazonLink(title) {
      if (!AMAZON_AFFILIATE_TAG) {
        return `https://www.amazon.in/s?k=${encodeURIComponent(title)}`;
      }
      return `https://www.amazon.in/s?k=${encodeURIComponent(title)}&tag=${AMAZON_AFFILIATE_TAG}`;
    }

    // ==============================
    // 6. Prompt – 16 gifts
    // ==============================
    function buildPrompt(selections){
      const {budget, occasion, relationship, interests, notes} = selections;
      const budgetText = budget ? `around ₹${budget}` : 'any budget';

      const interestsText = interests.length ? interests.join(', ') : 'no specific interests';

      return `You are a gift expert. Give **exactly 16** gift ideas for:
- Budget: ${budgetText}
- Occasion: ${occasion}
- Relationship: ${relationship}
- Interests: ${interestsText}
- Notes: ${notes || 'none'}

For each gift, return ONLY this JSON:
{
  "title": "short catchy name",
  "short": "1-line description",
  "price": "₹X–₹Y"
}
Return ONLY the JSON array. No extra text.`;
    }

    // ==============================
    // 7. Call Gemini
    // ==============================
    async function callGemini(selections){
      const prompt = buildPrompt(selections);

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ role: 'user', parts: [{ text: prompt }] }]
        })
      });

      const data = await response.json();

      const raw = data?.candidates?.[0]?.content?.parts?.[0]?.text || '';
      if(!raw.trim()) throw new Error('Empty response');

      const jsonMatch = raw.match(/\[[\s\S]*\]/);
      if(!jsonMatch) throw new Error('No JSON array found');

      const gifts = JSON.parse(jsonMatch[0]);
      if(!Array.isArray(gifts) || gifts.length===0) throw new Error('Invalid JSON');

      return gifts;
    }

    // ==============================
    // 8. Render with REAL images + Links
    // ==============================
    async function renderAIResults(gifts, selections){
      resultGrid.innerHTML = '';
      matchSummary.innerText = `${gifts.length} AI suggestions • ${selections.occasion}/${selections.relationship}`;
      happyMsg.style.display = 'none';

      for (let i = 0; i < gifts.length; i++) {
        const g = gifts[i];
        const div = document.createElement('div');
        div.className = 'giftCard';

        // Skeleton
        div.innerHTML = `
          <div class="giftTop">
            <div class="giftThumb" style="background:#eee;animation:pulse 1.5s infinite"></div>
            <div style="flex:1">
              <h4 class="giftTitle">${g.title}</h4>
              <div class="giftMeta">${g.short}</div>
              <div style="text-align:right">
                <div style="font-weight:800;font-size:14px">${g.price}</div>
                <div class="smallBadge">AI</div>
              </div>
              <div class="links">
                <a href="https://www.google.com/search?q=${encodeURIComponent(g.title)}" target="_blank" class="linkBtn">Google</a>
                <a href="${getAmazonLink(g.title)}" target="_blank" class="linkBtn amazon">Amazon</a>
              </div>
            </div>
          </div>
        `;

        resultGrid.appendChild(div);
        setTimeout(() => div.classList.add('show'), 50 * i); // Faster animation

        // Load image
        const imgUrl = await getRealGiftImage(g.title);
        const thumb = div.querySelector('.giftThumb');
        thumb.innerHTML = `<img src="${imgUrl}" alt="${g.title}" onerror="this.parentNode.style.background='linear-gradient(135deg,var(--accent-1),var(--accent-2))';this.style.display='none'">`;
        thumb.style.background = 'none';

        // Favourite
        div.addEventListener('click', e => {
          if (e.target.closest('a')) return;
          toggleFavourite(g.title);
          div.style.outline = '3px solid rgba(139,92,246,0.12)';
        });
      }

      setTimeout(() => { happyMsg.style.display = 'block'; }, 400); // Faster
    }

    // ==============================
    // 9. Loader
    // ==============================
    function showLoader(){
      resultGrid.innerHTML = `
        <div id="loader">
          <div class="spinner"></div>
          <div>AI thinking fast…</div>
        </div>`;
    }

    // ==============================
    // 10. Main AI search
    // ==============================
    async function findGiftsAI(){
      formError.style.display='none';
      const budget = budgetEl.value;
      const occasion = occasionEl.value;
      const relationship = relationshipEl.value;
      const interests = getSelectedInterests();
      const notes = notesEl.value.trim();

      if(!budget || !occasion || !relationship){
        formError.style.display='block';
        formError.innerText='Please fill Budget, Occasion and Relationship.';
        return;
      }

      const selections = {budget, occasion, relationship, interests, notes};
      showLoader();

      try{
        const gifts = await callGemini(selections);
        await renderAIResults(gifts, selections);
      }catch(err){
        resultGrid.innerHTML = `<div style="grid-column:1/-1;color:#c92a2a;padding:20px">Error: ${err.message}</div>`;
      }
    }

    // ==============================
    // 11. Save / Clear / Favourites
    // ==============================
    function saveSession(){
      const budget = budgetEl.value, occasion = occasionEl.value, relationship = relationshipEl.value;
      if(!budget||!occasion||!relationship){ alert('Fill required fields first.'); return; }
      const session = {budget,occasion,relationship,interests:getSelectedInterests(),notes:notesEl.value,ts:new Date().toISOString()};
      const arr = JSON.parse(localStorage.getItem('gift_ai_sessions')||'[]');
      arr.push(session);
      localStorage.setItem('gift_ai_sessions', JSON.stringify(arr));
      renderSaved();
      alert('Session saved locally.');
    }

    function renderSaved(){
      const arr = JSON.parse(localStorage.getItem('gift_ai_sessions')||'[]');
      if(!arr.length){ savedList.innerText='(none yet)'; return; }
      savedList.innerHTML = arr.slice(-6).reverse().map(s=>`
        <div style="padding:8px;border-radius:8px;margin-bottom:8px;background:#fffefc;">
          <div style="font-weight:700">${s.occasion} • ₹${s.budget}</div>
          <div style="font-size:13px;color:var(--muted)">${s.relationship} • ${s.interests.slice(0,3).join(', ')}</div>
        </div>`).join('');
    }

    function clearForm(){
      if(!confirm('Clear form and results?')) return;
      budgetEl.value=''; occasionEl.value=''; relationshipEl.value=''; notesEl.value='';
      interestsDiv.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
      resultGrid.innerHTML=''; matchSummary.innerText='No results yet'; happyMsg.style.display='none';
    }

    function toggleFavourite(id){
      const fav = JSON.parse(localStorage.getItem('gift_favourites')||'[]');
      if(fav.includes(id)){
        localStorage.setItem('gift_favourites', JSON.stringify(fav.filter(x=>x!==id)));
        alert('Removed from favourites.');
      }else{
        fav.push(id);
        localStorage.setItem('gift_favourites', JSON.stringify(fav));
        alert('Added to favourites.');
      }
    }

    // ==============================
    // 12. Events
    // ==============================
    findBtn.addEventListener('click', findGiftsAI);
    saveBtn.addEventListener('click', saveSession);
    clearBtn.addEventListener('click', clearForm);
    notesEl.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); findGiftsAI(); }});

    window.addEventListener('load', ()=>{
      renderSaved();
      ['Tech','Books'].forEach(t=> {
        const chip = interestsDiv.querySelector(`.chip[data-tag="${t}"]`);
        if(chip) chip.classList.add('active');
      });
    });
  </script>
</body>
</html>
